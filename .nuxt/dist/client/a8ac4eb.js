(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{525:function(e,t,n){var content=n(630);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(70).default)("3697c20a",content,!0,{sourceMap:!1})},629:function(e,t,n){"use strict";n(525)},630:function(e,t,n){var r=n(69)(!1);r.push([e.i,"\ntextarea[data-v-56d381a9] {\r\n  height: auto;\n}\n.message[data-v-56d381a9] {\r\n  width: 45%;\r\n  border-radius: 10px;\r\n  padding: .5em;\r\n  /*   margin-bottom: .5em; */\r\n  font-size: .8em;\n}\n.message-out[data-v-56d381a9] {\r\n/*var(--color2)*/\r\n  background-color: #D2FBA8;\r\n  margin-left: 50%;\n}\n.message-in[data-v-56d381a9] {\r\n  background: #f5f5f5;\r\n  color: black;\r\n  border: #b6bbc7 1px solid;\n}\n.e[data-v-56d381a9]:hover{\r\n  background-color:rgba(0,51,244,0.05);\n}\r\n\r\n",""]),e.exports=r},696:function(e,t,n){"use strict";n.r(t);var r=n(12),l=(n(53),n(43),n(1),n(27),n(37)),o=n(41),c=n(81);l.c.add(o.B),l.c.add(c.f),l.c.add(o.t);var d={name:"requests",data:function(){return{sendEmailWhenReceiveMessage:!0,firstRunflag:!1,cid:null,Rows:[],windowWidth:window.getComputedStyle(document.documentElement).getPropertyValue("--screen-mode"),selectedChat:null,messages:[],requests:[],msgTextBox:"",loadingChat:!0,loadingRequest:!1}},mounted:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loadingRequest=!0,t.next=3,e.getRequests();case 3:e.intervalX=setInterval(e.refreshTimer,5e3),e.userId=e.$auth.user.id,e.$nextTick((function(){window.addEventListener("resize",e.onResize)})),e.getCurrentUser();case 7:case"end":return t.stop()}}),t)})))()},methods:{toggleSendEmailOnNewMessage:function(e){try{this.$axios.post("/users/changeSendEmailOnNewMessage",{status:e}).then((function(e){})).catch((function(e){}))}catch(e){}},getCurrentUser:function(){var e=this;try{this.$axios.post("/users/getCurrentUser").then((function(t){e.sendEmailWhenReceiveMessage=t.data.receiveEmailOnMessage})).catch((function(e){}))}catch(e){}},gotoChat:function(){if(this.cid=this.$route.query.cid,this.cid>0&&null!==this.requests)for(var i=0;i<this.requests.length;i++)try{var e=this.requests[i];if(e.receiverId==this.cid&&e.senderId==this.cid)return void this.selectUser(e,i);if(e.receiverId==this.cid&&e.senderId==this.$auth.user.id)return void this.selectUser(e,i);if(e.senderId==this.cid&&e.receiverId==this.$auth.user.id)return void this.selectUser(e,i)}catch(e){}},GetTime:function(e,t){return(e<10?"0"+Math.floor(e/2):e/2).toString()+":"+(e%2==0?"00":"30")+" - "+(t<10?"0"+Math.floor(t/2):t/2).toString()+":"+(t%2==0?"00":"30")},DayOfWeek:function(e){return["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"][e]},deleteMessage:function(e,t){var n=this,r=e;e===this.$auth.user.id&&(r=t);var l={senderId:r};this.$bvModal.msgBoxConfirm(this.$t("requests.delete_all"),{title:"Confirm",size:"md",buttonSize:"sm",okVariant:"danger",okTitle:"YES",cancelTitle:"NO",footerClass:"p-2 border-top-0",hideHeaderClose:!1,headerClass:"p-2 border-bottom-0",centered:!0}).then((function(e){!0===e&&n.$axios.post("/request/delete-all-request",l).then((function(e){"removed"===e.data&&(n.selectedChat=null,n.messages=[])})).catch((function(e){console.log(e)}))}))},onResize:function(){this.windowWidth=window.getComputedStyle(document.documentElement).getPropertyValue("--screen-mode")},sendMessage:function(){var e=this;try{if(0===this.msgTextBox.length)return;var t={receiverId:this.selectedChat.receiverId===this.userId?this.selectedChat.senderId:this.selectedChat.receiverId,text:this.msgTextBox,createdAt:new Date,type:0,entityId:0};this.msgTextBox="",this.$axios.post("/request/create",t).then((function(t){!0===t.data.ok&&(e.messages.push(t.data.data),setTimeout((function(){var e=document.getElementById("chatBox");e.scrollTop=e.scrollHeight}),20))})).catch((function(e){console.log(e)}))}catch(e){}},selectUser:function(e,t){this.deselect(t),this.loadingChat=!0,this.selectedChat=e,this.getChat(e,!0)},deselect:function(e){for(var i=0;i<this.requests.length;i++)this.Rows[i]=!1;e>-1&&(this.Rows[e]=!0)},getRequests:function(){var e=this;try{this.$axios.post("request/getRequests",null).then((function(t){e.requests=t.data.data;for(var i=0;i<e.requests.length;i++)e.Rows[i]=!1;e.loadingRequest=!1,!1===e.firstRunflag&&(e.firstRunflag=!0,e.gotoChat())})).catch((function(e){}))}catch(e){console.log(e)}},getChat:function(e,t){var n=this,r=this.$auth.user.id,l={sUid:r=r===e.receiverId?e.senderId:e.receiverId};this.$axios.post("request/getUserRequests",l).then((function(r){n.loadingChat=!1,n.messages=r.data.data,t&&setTimeout((function(){var e=document.getElementById("chatBox");e.scrollTop=e.scrollHeight}),20),n.$axios.post("/request/setview",l).then((function(t){e.viewed=1})).catch((function(e){}))})).catch((function(e){n.loadingChat=!1}))},refreshTimer:function(){this.getRequests(),null!==this.selectedChat&&this.getChat(this.selectedChat,!1)}},beforeDestroy:function(){clearInterval(this.intervalX),window.removeEventListener("resize",this.onResize)}},h=(n(629),n(80)),component=Object(h.a)(d,(function(){var e=this,t=e._self._c;return t("b-container",{staticClass:"h-100",attrs:{fluid:""}},[t("div",{staticClass:"w-100 my-3"},[t("b-checkbox",{attrs:{switch:""},on:{change:e.toggleSendEmailOnNewMessage},model:{value:e.sendEmailWhenReceiveMessage,callback:function(t){e.sendEmailWhenReceiveMessage=t},expression:"sendEmailWhenReceiveMessage"}},[e._v(e._s(e.$t("email_on_new_message")))])],1),e._v(" "),t("div",{staticClass:"w-100 h-100 d-flex"},[t("b-row",{directives:[{name:"show",rawName:"v-show",value:"xl"===e.windowWidth||"lg"===e.windowWidth||null===e.selectedChat,expression:" (windowWidth === 'xl' || windowWidth === 'lg') ?true :(selectedChat === null)"}],staticClass:"m-0",class:"xl"===e.windowWidth||"lg"===e.windowWidth?"w-70":"w-100"},[0===e.requests.length?t("p",{staticClass:"text-center w-100 mt-3",staticStyle:{color:"#a8a7a7"}},[e._v(e._s(e.$t("no_message")))]):e._e(),e._v(" "),t("b-overlay",{staticClass:"w-100",attrs:{show:e.loadingRequest,variant:"transparent",opacity:.8,blur:"3px",rounded:"sm"}},[t("div",{staticClass:"mt-2",style:"xl"===e.windowWidth||"lg"===e.windowWidth?" min-width: 400px;":"min-width: 100%;"},e._l(e.requests,(function(n,r){return t("div",{key:r,staticClass:"mt-1 w-100",on:{click:function(t){return e.selectUser(n,r)}}},[t("div",{staticClass:"w-100 p-2 mt-0 shadow-sm d-flex e rounded-lg",staticStyle:{cursor:"pointer"},style:!0===e.Rows[r]?"background-color: rgba(144,169,244,0.32)":""},[t("b-avatar",{attrs:{size:"3rem",src:null!=n.image_ru?"/"+n.image_ru:"",alt:"Cropped Image"}}),e._v(" "),t("div",{staticClass:"pl-3 w-100"},[t("span",{staticClass:"font-weight-bold"},[e._v(" "+e._s(n.viewName+" "+(null!==n.viewLname?n.viewLname:"")))]),e._v(" "),t("span",{staticClass:"float-right small"},[e._v("\n                  "+e._s(e._f("moment")(n.createdAt,"ddd, MMM DD, YYYY, hh:mm:ss a"))+"\n                "),t("b-link",{staticClass:"mr-4",staticStyle:{color:"#bfbfbf"},attrs:{size:"sm"},on:{click:function(t){return e.deleteMessage(n.senderId,n.receiverId)}}},[t("font-awesome-icon",{staticClass:"shop-icon",attrs:{icon:["fas","trash"]}})],1)],1),e._v(" "),t("div",{staticClass:"w-100 three-dot-one-line"},[e._v("\n                  "+e._s(n.text+" ")+"\n                  "),n.unread>0?t("b-badge",{attrs:{variant:"success"}},[e._v(e._s(n.unread)+"\n                  ")]):e._e()],1)])],1)])})),0)])],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:"xl"===e.windowWidth||"lg"===e.windowWidth||null!==e.selectedChat,expression:"(windowWidth === 'xl' || windowWidth === 'lg' )?true :(selectedChat!==null)"}],staticClass:"w-100 shadow h-100 mt-2 ml-3 p-3"},[null===e.selectedChat?t("div",{staticClass:"text-center",staticStyle:{color:"#a8a7a7"}},[e._v("\n        "+e._s(e.$t("Please_select_one_message"))+"\n      ")]):t("div",[t("b-overlay",{attrs:{show:e.loadingChat,variant:"transparent",opacity:.8,blur:"3px",rounded:"sm"}},[t("div",{staticClass:"d-flex"},[t("b-avatar",{attrs:{size:"3rem",src:null!=e.selectedChat.image_ru?"/"+e.selectedChat.image_ru:"",alt:"Cropped Image"}}),e._v(" "),t("div",{staticClass:"pl-3 w-100 mt-3"},[t("span",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e.selectedChat.viewName+" "+e.selectedChat.viewLname))])]),e._v(" "),t("b-link",{directives:[{name:"show",rawName:"v-show",value:"xl"!==e.windowWidth&&"lg"!==e.windowWidth,expression:"windowWidth !== 'xl' && windowWidth !== 'lg'"}],staticClass:"float-right",on:{click:function(t){e.selectedChat=null}}},[t("svg",{staticClass:"bi-arrow90deg-left mx-auto b-icon bi",attrs:{"data-v-41be6633":"",viewBox:"0 0 16 16",width:"1em",height:"1em",focusable:"false",role:"img","aria-label":"arrow90deg left",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"}},[t("g",{attrs:{"data-v-41be6633":""}},[t("path",{attrs:{"fill-rule":"evenodd",d:"M1.146 4.854a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 4H12.5A2.5 2.5 0 0 1 15 6.5v8a.5.5 0 0 1-1 0v-8A1.5 1.5 0 0 0 12.5 5H2.707l3.147 3.146a.5.5 0 1 1-.708.708l-4-4z"}})])])])],1),e._v(" "),t("div",{staticClass:"h-100 mt-2",staticStyle:{"max-height":"400px",overflow:"auto"},attrs:{id:"chatBox"}},e._l(e.messages,(function(n){return t("div",{staticClass:"message mb-2",class:n.receiverId===e.userId?"message-in":"message-out"},[0===n.type?t("span",{staticStyle:{"white-space":"pre-wrap"}},[e._v(e._s(n.text))]):e._e(),e._v(" "),1===n.type?t("span",{staticStyle:{"white-space":"pre-wrap"}},[t("div",{staticClass:"p-2 mx-1",staticStyle:{"background-color":"white","border-radius":"10px"}},[t("span",{staticClass:"font-weight-bold",staticStyle:{color:"#dc3545"}},[e._v(e._s(e.$t("mylesson.request.from.user"))+" ")]),e._v(" "),t("div",{staticClass:"mt-2",staticStyle:{"white-space":"normal"}},[t("div",[t("span",{staticStyle:{color:"black"}},[e._v("Lesson: ")]),e._v(e._s(null!=n.MyLesson?n.MyLesson.Lesson.subject:""))]),e._v(" "),t("div",[t("span",{staticStyle:{color:"black"}},[e._v("Week Day :")]),e._v(e._s(null!=n.MyLesson?e.DayOfWeek(n.MyLesson.dayOfWeek):"")+" ")]),e._v(" "),t("div",[t("span",{staticStyle:{color:"black"}},[e._v("Time :"+e._s(null!=n.MyLesson?e.GetTime(n.MyLesson.timeStart,n.MyLesson.timeEnd):""))])]),e._v(" "),t("div",{staticClass:"text-center"},[t("b-button",{staticClass:"btn btn-info small mt-2",attrs:{size:"sm",to:n.senderId===e.userId?"/user-panel/taken-lessons":"/user-panel/my-lessons"}},[e._v(e._s(e.$t("mylesson.request.from.user.link"))+" ")])],1)])]),e._v(" "),t("div",{staticStyle:{"white-space":"normal"}},[t("hr",{staticClass:"my-0",staticStyle:{width:"100%","text-align":"left","margin-left":"0"}}),e._v(" "),t("span",{staticStyle:{"white-space":"pre-wrap"}},[e._v(e._s(n.text))])])]):e._e(),e._v(" "),2===n.type?t("span",{staticStyle:{"white-space":"pre-wrap"}},[t("div",{staticClass:"p-2 mx-1",staticStyle:{"background-color":"#e3fde3","border-radius":"10px"}},[t("span",{staticClass:"font-weight-bold",staticStyle:{color:"#046b0f"}},[e._v(e._s(e.$t("mylesson.request.verify.user"))+" ")]),e._v(" "),t("div",{staticClass:"mt-2",staticStyle:{"white-space":"normal"}},[t("div",[t("span",{staticStyle:{color:"black"}},[e._v("Lesson: ")]),e._v(e._s(null!=n.MyLesson?n.MyLesson.Lesson.subject:""))]),e._v(" "),t("div",[t("span",{staticStyle:{color:"black"}},[e._v("Week Day :")]),e._v(e._s(null!=n.MyLesson?e.DayOfWeek(n.MyLesson.dayOfWeek):"")+" ")]),e._v(" "),t("div",[t("span",{staticStyle:{color:"black"}},[e._v("Time :"+e._s(null!=n.MyLesson?e.GetTime(n.MyLesson.timeStart,n.MyLesson.timeEnd):""))])]),e._v(" "),t("div",{staticClass:"text-center"},[t("b-button",{staticClass:"btn btn-info small mt-2",attrs:{size:"sm",to:n.senderId!==e.userId?"/user-panel/taken-lessons":"/user-panel/my-lessons"}},[e._v(e._s(e.$t("mylesson.request.from.user.link"))+" ")])],1)])]),e._v(" "),t("div",{staticStyle:{"white-space":"normal"}},[t("hr",{staticClass:"my-0",staticStyle:{width:"100%","text-align":"left","margin-left":"0"}}),e._v(" "),t("span",{staticStyle:{"white-space":"pre-wrap"}},[e._v(e._s(n.text))])])]):e._e(),e._v(" "),3===n.type?t("span",{staticStyle:{"white-space":"pre-wrap"}},[t("div",{staticClass:"p-2 mx-1",staticStyle:{"background-color":"#ffe7e8","border-radius":"10px"}},[t("span",{staticClass:"font-weight-bold",staticStyle:{color:"#f81f1f"}},[e._v(e._s(e.$t("mylesson.request.reject.user"))+" ")]),e._v(" "),t("div",{staticClass:"mt-2",staticStyle:{"white-space":"normal"}},[t("div",[t("span",{staticStyle:{color:"black"}},[e._v("Lesson: ")]),e._v(e._s(null!=n.MyLesson?n.MyLesson.Lesson.subject:""))]),e._v(" "),t("div",[t("span",{staticStyle:{color:"black"}},[e._v("Week Day :")]),e._v(e._s(null!=n.MyLesson?e.DayOfWeek(n.MyLesson.dayOfWeek):"")+" ")]),e._v(" "),t("div",[t("span",{staticStyle:{color:"black"}},[e._v("Time :"+e._s(null!=n.MyLesson?e.GetTime(n.MyLesson.timeStart,n.MyLesson.timeEnd):""))])]),e._v(" "),t("div",{staticClass:"text-center"},[t("b-button",{staticClass:"btn btn-info small mt-2",attrs:{size:"sm",to:n.senderId!==e.userId?"/user-panel/taken-lessons":"/user-panel/my-lessons"}},[e._v(e._s(e.$t("mylesson.request.from.user.link"))+" ")])],1)])]),e._v(" "),t("div",{staticStyle:{"white-space":"normal"}},[t("hr",{staticClass:"my-0",staticStyle:{width:"100%","text-align":"left","margin-left":"0"}}),e._v(" "),t("span",{staticStyle:{"white-space":"pre-wrap"}},[e._v(e._s(n.text))])])]):e._e(),e._v(" "),t("div",{staticClass:"text-right small mr-2 mb-n1"},[t("span",[e._v(" "+e._s(e._f("moment")(null!=n.createdAt?n.createdAt:"","ddd, MMM DD, YYYY, hh:mm:ss a"))+" ")]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:n.receiverId!==e.userId,expression:"message.receiverId !== userId"}]},[!1===n.viewed||0===n.viewed||null===n.viewed?t("svg",{staticClass:"bi bi-check",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"}},[t("path",{attrs:{d:"M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"}})]):e._e(),e._v(" "),!0===n.viewed?t("svg",{staticClass:"bi bi-check-all",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"}},[t("path",{attrs:{d:"M8.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L2.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093L8.95 4.992a.252.252 0 0 1 .02-.022zm-.92 5.14.92.92a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 1 0-1.091-1.028L9.477 9.417l-.485-.486-.943 1.179z"}})]):e._e()])])])})),0)]),e._v(" "),t("div",{staticClass:"d-flex mt-2"},[t("b-input-group",[t("b-form-textarea",{staticClass:"overflow-hidden",attrs:{"no-resize":"",rows:"2"},on:{keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:(t.preventDefault(),e.sendMessage.apply(null,arguments))}},model:{value:e.msgTextBox,callback:function(t){e.msgTextBox=t},expression:"msgTextBox"}}),e._v(" "),t("b-input-group-append",[t("b-button",{staticClass:"btn btn-primary px-4",on:{click:e.sendMessage}},[t("font-awesome-icon",{staticStyle:{"margin-right":"5px"},attrs:{icon:["fas","paper-plane"]}})],1)],1)],1)],1)],1)])],1)])}),[],!1,null,"56d381a9",null);t.default=component.exports}}]);